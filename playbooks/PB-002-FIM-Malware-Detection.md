# üìò Tier 1 Playbook: PB-002

## FIM Alert / Suspicious File Detection

| Field | Value |
|-------|-------|
| **Playbook ID** | PB-002 |
| **Version** | 1.0 |
| **Last Updated** | December 9, 2025 |
| **Author** | Esteban (SOC Analyst) |
| **Threat Type** | Suspicious File / Potential Malware |
| **Severity** | üü† MEDIUM to üî¥ HIGH |
| **MITRE ATT&CK** | [T1565.001 - Stored Data Manipulation](https://attack.mitre.org/techniques/T1565/001/) |

---

## Scope

This playbook covers **Tier 1 SOC Analyst responsibilities**:

| ‚úÖ Tier 1 Responsibilities | ‚ùå Out of Scope (Tier 2/3) |
|---------------------------|---------------------------|
| Alert triage | File removal/quarantine |
| Gather file metadata | Malware analysis |
| Collect file hashes | System forensics |
| Documentation | Endpoint isolation |
| Escalation to Tier 2 | Remediation actions |

---

## Trigger Conditions

Execute this playbook when you see these Wazuh FIM alerts:

| Rule ID | Description | Level |
|---------|-------------|-------|
| 550 | Integrity checksum changed | 7 |
| 553 | File deleted | 7 |
| 554 | File added to the system | 5 |
| 555 | File renamed | 5 |

---

## Step 1: Alert Triage

**‚è±Ô∏è Time: 2-3 minutes**

1. Open Wazuh Dashboard ‚Üí **Discover**
2. Set time range to **Last 30 minutes**
3. Filter: `rule.groups: syscheck`
4. Note total alert count and affected systems

**Quick Assessment:**

| Indicator | Risk Level |
|-----------|------------|
| File in /tmp, /dev/shm | üü† Medium - common malware locations |
| File in /home, /root | üü† Medium - user directory |
| File in /bin, /usr/bin, /etc | üî¥ High - system directories |
| Multiple files at once | üî¥ High - possible attack in progress |
| Single file, known location | üü¢ Low - may be legitimate |

---

## Step 2: Gather File Information

**‚è±Ô∏è Time: 3-5 minutes**

Click on the alert and document these fields:

| Field | Where to Find | Your Notes |
|-------|---------------|------------|
| **File Path** | `syscheck.path` | _______________ |
| **Event Type** | `syscheck.event` | _______________ |
| **MD5 Hash** | `syscheck.md5_after` | _______________ |
| **SHA256 Hash** | `syscheck.sha256_after` | _______________ |
| **File Size** | `syscheck.size_after` | _______________ |
| **File Owner** | `syscheck.uname_after` | _______________ |
| **Permissions** | `syscheck.perm_after` | _______________ |
| **Timestamp** | `syscheck.mtime_after` | _______________ |
| **Target System** | `agent.name` | _______________ |

**Take screenshots of:**
- Alert overview
- Expanded alert details showing hashes

---

## Step 3: Assess the File Location

**Common suspicious locations:**

| Location | Why It's Suspicious |
|----------|---------------------|
| `/tmp` | Temporary storage, often used by malware |
| `/dev/shm` | Memory-based storage, hides from disk scans |
| `/var/tmp` | Persists through reboots, malware staging |
| `/home/*/Downloads` | User-downloaded files |
| Hidden files (`.filename`) | Attempt to avoid detection |

**Your file location:** _______________ 

**Risk assessment:** ‚òê High ‚òê Medium ‚òê Low

---

## Step 4: Check File Details

Review the information gathered:

| Question | Yes | No |
|----------|-----|-----|
| Is the file in a suspicious location? | ‚òê | ‚òê |
| Is the file owner unexpected? | ‚òê | ‚òê |
| Is the file size very small (<1KB) or very large? | ‚òê | ‚òê |
| Does the filename look suspicious? | ‚òê | ‚òê |
| Were multiple files created at once? | ‚òê | ‚òê |

**More "Yes" answers = Higher likelihood of malicious file**

---

## Step 5: Classification Decision

### True Positive Indicators
- File in suspicious location (/tmp, /dev/shm)
- Unknown or unexpected file owner
- File appeared without legitimate explanation
- Multiple suspicious files at once
- Suspicious filename (random characters, mimics system file)

### False Positive Indicators
- File created by known application
- Matches recent user activity
- System update or package installation
- Temporary file from legitimate software

**Classification:** ‚òê True Positive ‚Üí Escalate to Tier 2
**Classification:** ‚òê False Positive ‚Üí Document and close

---

## Step 6: Documentation

Before escalating, ensure you have:

- [ ] Screenshots of FIM alerts
- [ ] File path documented
- [ ] File hashes recorded (MD5, SHA256)
- [ ] File owner and permissions noted
- [ ] Timestamp of file creation
- [ ] Affected system identified
- [ ] Classification decision documented

---

## Escalation to Tier 2

**When to escalate:**
- Classified as True Positive
- File in critical system directory
- Multiple files detected
- Unsure about file legitimacy
- Evidence of malware signature

### Escalation Template

```
ESCALATION TO TIER 2

Incident ID: INC-___
Time Detected: 
Analyst: 

SUMMARY:
FIM detected suspicious file on [SYSTEM NAME].

FILE DETAILS:
- Path: 
- Event Type: added / modified / deleted
- MD5: 
- SHA256: 
- Size: 
- Owner: 
- Permissions: 
- Created: 

CLASSIFICATION: True Positive - Suspicious File

TIER 1 ACTIONS COMPLETED:
‚úì Alert triage completed
‚úì File metadata documented
‚úì Hashes collected for threat intel lookup
‚úì Screenshots captured

RECOMMENDED TIER 2 ACTIONS:
- Check hash against VirusTotal/threat intel
- Analyze file if safe to do so
- Remove/quarantine if malicious
- Investigate file origin
- Check for related IOCs

ATTACHMENTS:
- Screenshot: Alert overview
- Screenshot: File details with hashes
```

---

## Quick Reference

### Wazuh Filters

```
# All FIM alerts
rule.groups: syscheck

# File added
rule.id: 554

# File modified
rule.id: 550

# File deleted
rule.id: 553

# Filter by path
syscheck.path: /tmp/*

# Filter by system
agent.name: ubuntu-desktop
```

### Key Fields for Documentation

| Field | Description |
|-------|-------------|
| `syscheck.path` | Full file path |
| `syscheck.event` | added, modified, deleted |
| `syscheck.md5_after` | MD5 hash |
| `syscheck.sha256_after` | SHA256 hash |
| `syscheck.size_after` | File size in bytes |
| `syscheck.uname_after` | File owner username |
| `syscheck.perm_after` | File permissions |
| `syscheck.mtime_after` | Modification time |

---

## What Happens After Escalation?

Once escalated, Tier 2 typically handles:
- Hash lookup against threat intelligence (VirusTotal, etc.)
- Malware analysis (if needed)
- File removal or quarantine
- Investigation of how file was created
- Checking for additional indicators of compromise
- Endpoint scanning

*As a Tier 1 analyst, your job is complete once you've gathered file details, documented findings, and escalated.*

---

## References

- [MITRE ATT&CK T1565.001](https://attack.mitre.org/techniques/T1565/001/)
- [Wazuh FIM Documentation](https://documentation.wazuh.com/current/user-manual/capabilities/file-integrity/index.html)
- [EICAR Test File Info](https://www.eicar.org/download-anti-malware-testfile/)

---

## Revision History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | Dec 9, 2025 | Initial playbook |

---

*This playbook reflects Tier 1 SOC Analyst responsibilities for FIM alerts and suspicious file detection.*
